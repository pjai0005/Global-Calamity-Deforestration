---
title: "ETC5521 Assignment 1"
subtitle: "Deforestration"
team: Cuscus
author:
  - Pian Li
  - Prachi Jaiswal
date: "`r Sys.Date()`"
bibliography: reference.bib
link-citations: yes
output:
  bookdown::html_document2
---

[This assignment is for ETC5521 Assignment 1 by Team `r rmarkdown::metadata$team` comprising of `r knitr::combine_words(rmarkdown::metadata$author)`.]{style="color:#006DAE;"}


# Introduction and motivation

[FILL] Give the bigger picture of the data, and inspire the reader to learn more about the problem by reading your analysis. 

# Data description

## Data source

We have selected the data from the GitHub webpage (https://github.com/rfordatascience/tidytuesday/blob/master/data/2021/2021-04-06/readme.md) which talks about the drivers of deforestation over years. We have selected six datasets related to deforestation and several variables are analyzed: forest area, deforestation, imported deforestation, exported deforestation, human food, animal food, processed, crop oil and production.

The following is our datasets which were obtained from GitHub’s TidyTuesday:

1. Forest area: 
- entity is a character type that shows the country name.
- code is a character type that shows the country code.
- year is an integer type that shows the year from 1990 to 2020.
- forest_area is a double type that shows the per cent of global forest area.


2. Annual deforestation: 
- entity is a character type that shows the country name.
- code is a character type that shows the country code.
- year is a double type that shows the year from 1990 to 2015.
- deforestation is a double type that shows the deforested area in hectares.


3. Imported deforestation:
- entity is a character type that shows the country name.
- code is a character type that shows the country code.
- year is a double type that shows the year from 2005 to 2013.
- imported deforestation is a double type that shows each country’s imported deforestation, measured in hectares.


4. Exported deforestation:
- entity is a character type that shows the country name.
- code is a character type that shows the country code.
- year is a double type that shows the year from 2005 to 2013.
- exported deforestation is a double type that shows each country’s exported deforestation, measured in hectares.


5. Soybean use:
- entity is a character type that shows the country name.
- code is a character type that shows the country code.
- year is a double type that shows the year from 1961 to 2013.
- human food is a double type that shows soybean use for human food (tempeh, tofu, etc).
- animal feed is a double that shows soybean used for animal food.
- processed is a double that shows soybean processed into vegetable oil, biofuel, processed animal feed.


6. Vegetable oil:
- entity is a character type that shows the country name.
- code is a character type that shows the country code.
- year is an integer type that shows the year from 1961 to 2014.
- crop_oil is a character type that shows crops that were used to produce vegetable oil.
- production is a double type that shows oil production in tonnes. 


## Dataset source
The data is originally obtained from “Our World in Data”. And this article "Forests and Deforestation" is retrieved from: 'https://ourworldindata.org/forests-and-deforestation' and written by Hannah Ritchie and Max Roser (2021).

```{r, libraries, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, cache = FALSE, message = FALSE, warning = FALSE, cache.lazy = FALSE )
#remotes::install_github('htmlwidgets/sparkline')
library(tidyverse)
library(sparkline)
library(DT)
library(tidyverse)
library(maps)
library(ggplot2)
library(ggthemes)
library(gridExtra)
library(broom)
library(RColorBrewer)
library(kableExtra)
library(ggpubr)
```

```{r, datasets, include=FALSE}
forest_area<- read.csv("data/forest_area.csv")
deforestation<- read.csv("data/deforestation.csv")

imported<- read.csv("data/imported-deforestation.csv")
exported<- read.csv("data/exported-deforestation.csv")

soy<- read.csv("data/soybean_use.csv")
oil<- read.csv("data/vegetable_oil.csv")

```


## Proposed Research Questions:

1. How are forests distributed across the world and how much each region contributes to deforestation?

2. Who are the largest ‘importers’ and ‘exporters’ of deforestation?

3. Does higher production of commodities(palm oil/soybean) result in a higher deforestation rate?


# Analysis and findings

## How are forests distributed across the world and how much each region contributes to deforestation?

```{r, fig.cap= "Forest area distibuted across the world", fig.align='center'}
fa <- forest_area %>% group_by(entity) %>%
  summarise (farea = mean (forest_area, na.rm = TRUE)) %>%
  rename(region = "entity")


world_map <- map_data("world")
world_map <- subset(world_map, region != "Antarctica")

ggplot(fa) +
  geom_map(dat = world_map, map = world_map, aes(map_id = region),
    fill = "white", color = "#7f7f7f", size = 0.25) +
  
  geom_map(map = world_map, aes(map_id = region, fill = farea), size = 0.25) +
  scale_fill_gradient(low = "#c8e3aa", high = "#1c330c", name = "Forest Area") +
  expand_limits(x = world_map$long, y = world_map$lat)
```
Through the above map, we can understand that Russia and Brazil dominate the world with larger forest areas. It also can be seen that China has the largest forest area in Asia. However, several observations are missing here for some countries, such as the United States.


The below table shows the deforestation rate among the continents of the world. It can be clearly seen through the line graph that though South America’s deforestation rate has seen a significant decrease over the years, it still outstands the other continents with the highest amount of deforestation in hectares.

```{r}
deforestation %>% 
  group_by(Entity) %>%
  select(Entity, Year, Deforestation) %>%
  filter(Entity %in% c("Africa", "Asia", "Europe", "North America", "Oceania", "South America" )) %>%
  summarise (`Deforestation in hectars` = mean (Deforestation, na.rm = TRUE),
              Min = min(Deforestation, na.rm = TRUE),
              Max = max(Deforestation, na.rm = TRUE),
             `Line graph` = spk_chr(Deforestation, type ="line"),
             `Boxplot` = spk_chr(Deforestation, type ="box"))%>%  
  datatable(escape = FALSE, options = c (list(pageLength = 10, digits = 2))) %>%
  spk_add_deps()
```
 Interestingly, Africa doesn’t stand far behind and sees an increasing pace of deforestation and is the only country whose number soars high over the years. Even though the data set consists of some missing values for the continent, Africa still manages to share the average deforestation rate alongside South America. Intriguing, Europe’s graph exhibit some unusual increment and a sudden decrement in logging. While the rest of the continents see a fairly declined pattern over the years.


## Who are the largest ‘importers’ and ‘exporters’ of deforestation?

Most deforestation occurs for the production of goods that are consumed within domestic markets. In this section, the amount of deforestation embedded in traded products between some countries is being analyzed, aiming to determine the major importers and exporters of deforestation-related consumed products across the world.

```{r q2plot, eval=TRUE, echo = FALSE, message=FALSE, fig.width=14, fig.height=6, fig.cap="Exported and Imported Deforestation"}

library(tidyverse)
library(ggplot2)
library(ggpubr)


exported_deforestation <- read.csv("data/exported-deforestation.csv")
imported_deforestation <- read.csv("data/imported-deforestation.csv")


imported <- imported_deforestation %>% filter(Entity %in% c("China",
                                  "Japan",
                                  "India",
                                  "Russia",
                                  "Egypt",
                                  "United States")) %>%
  rename(`Imported Country` = `Entity`)

g1 <- ggplot(data = imported, aes(x = Year, y = imported_deforestation, group = `Imported Country`, color = `Imported Country`)) + 
  geom_line(size = 1) + 
  geom_point(size = 2) +
  scale_color_manual(values=c("#CC6666","#E69F00","#9999CC","#66CC99","#F0E442","#CC79A7")) +
  theme_bw() +
  theme_grey()+
  xlab("Year") +
  ylab("Imported Deforestation (hectares)") +
  ylim(0,510000)





exported <- exported_deforestation %>% filter(Entity %in% c("Indonesia",
                                  "Brazil",
                                  "Argentina",
                                  "Paraguay",
                                  "Malaysia",
                                  "Thailand")) %>%
  rename(`Exported Country` = `Entity`)

g2 <- ggplot(data = exported, aes(x = Year, y = exported_deforestation, group = `Exported Country`, color = `Exported Country`)) + 
  geom_line(size = 1) + 
  geom_point(size = 2) +
  scale_color_manual(values=c("#CC6666","#E69F00","#9999CC","#66CC99","#F0E442","#CC79A7")) +
  theme_bw() +
  theme_grey() +
  xlab("Year") +
  ylab("Exported Deforestation (hectares)")


ggarrange(g1,g2,ncol = 2)

```

The figure \@ref(fig:q2plot) above provides a general view of which country is the largest importer and exporter of deforestation. The x-axis shows the years from 2005 to 2013, while the y-axis represents the imported and exported deforestation measured by hectares.

It is clear that China is the largest importer of deforestation over this period. Also, Indonesia passed Brazil in near 2008 and has become the largest deforestation exporter.


```{r q2table, eval=TRUE, echo = FALSE, message=FALSE}
library(tidyverse)
library(kableExtra)
library(ggpubr)



ex <- exported_deforestation %>%
  filter(`Year` %in% c(2005,2013)) %>%
  pivot_wider(names_from = Year, values_from = `exported_deforestation`) %>%
  rename(`Exported Country` = `Entity`) %>%
  mutate(`Relative change (%)` = ((`2013` - `2005`)/`2005`) * 100) %>%
  arrange(desc(`2013`)) %>%
  head(10)


im <- imported_deforestation %>%
  filter(`Year` %in% c(2005,2013)) %>%
  pivot_wider(names_from = Year, values_from = `imported_deforestation`) %>%
  rename(`Imported Country` = `Entity`) %>%
  mutate(`Relative change (%)` = ((`2013` - `2005`)/`2005`) * 100) %>%
  arrange(desc(`2013`)) %>%
  head(10)

ex_im = cbind(ex,im)

kable(ex_im, caption = "Deforestation Embedded In Exported And Imported Goods") %>%
  kable_paper("hover", full_width = F)



```

The above table \@ref(tab:q2table) shows the major deforestation-related commodities exporter and importer and their relative percentage change of 2005 and 2013. Among all these countries, it can be seen that five exported countries and two imported countries have a significant increase of more than 100 %. Another interesting finding is that most exporters are low-income countries while most imported countries are high-income or upper-middle-income. Therefore, it is reasonable to say that the more affluent countries are more likely to contribute to deforestation in poorer countries.

## Does higher production of commodities(palm oil/soybean) result in a higher deforestation rate?

To solve the problem, one needs to know about the root cause of the problem. Out of the three general classifications of the forest: 

* Temperate forests (found across eastern North America and Eurasia). 
* Tropical forests (common in areas near the equator, such as Southeast Asia, sub-Saharan Africa, and Central America). 
* and the third Boreal forests, (found across Siberia, Scandinavia, Alaska and Canada).

The most concentrated deforestation occurs in tropical rainforests because they have the ability to provide considerably the most used commodities to the world. These commodities mainly consist of beef, oilseeds, soy, forestry items, and other edibles.

### Soybean

```{r eval=TRUE,echo=FALSE}
soya %>% 
  group_by(entity) %>%
  select(entity, processed, human_food, animal_feed) %>%
  rename(Country = entity) %>%
  summarise (`Production in Tonnes` = round(mean(processed, na.rm = TRUE)),
             `Human Usage in Tonnes` = round(mean(human_food, na.rm = TRUE)),
             `Animal Usage in Tonnes` = round(mean(animal_feed, na.rm = TRUE)))%>% 
  datatable(escape = FALSE, 
            ,caption = htmltools::tags$caption( style = 'caption-side: top; 
                                                text-align: center;  color:black; font-size:150% ;',
                                                'Usage and Production of Soy'),
            options = c (list(pageLength = 10 ))) %>%
  spk_add_deps()

```


Soybean production has seen an enormous amount of surge over the past 50 years. More than 70% of soybean is used to feed animals while approx 20% and 4% of the remaining soy is used for human food and industries respectively.

```{r eval=TRUE,echo=FALSE}
soya <- soy %>% group_by(entity) %>%
  mutate(used = human_food + animal_feed)

soya_lm <- lm(used ~ processed, data= soya)

augment(soya_lm) %>% 
  ggplot(aes(x= processed, y = used))+
  geom_point( colour= "red", alpha= .5, size = 3)+
  theme_bw()+
  geom_smooth(method = "lm")+
  labs (title = "Production of Soybean vs Usage of Soybean")

```

The above graph shows the linear relationship between consumption and the production of soybean. They are positively correlated which means the soybean production will increase when the consumption in soybean rises. We can learn that though it is linearly a good fit, it still has got slightly higher demand than production. 


# References
